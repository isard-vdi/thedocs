



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="IsardVDI Technical & Practical info (Escola del Treball Barcelona)">
      
      
        <link rel="canonical" href="http://thedocs.isardvdi.com/networking/concepts/">
      
      
        <meta name="author" content="IsardVDI">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.2">
    
    
      
        <title>Concepts - IsardVDI Technical docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="orange" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#network-linux-commands" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://thedocs.isardvdi.com" title="IsardVDI Technical docs" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                IsardVDI Technical docs
              </span>
              <span class="md-header-nav__topic">
                Concepts
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/isard-vdi/thedocs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      isard-vdi/thedocs
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../images/logo.svg" width="48" height="48">
      
    </span>
    IsardVDI Technical docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/isard-vdi/thedocs/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      isard-vdi/thedocs
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Storage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Storage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/raid/" title="Raid" class="md-nav__link">
      Raid
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/drbd/" title="DRBD" class="md-nav__link">
      DRBD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Cache
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Cache
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/cache/eio/" title="EiO" class="md-nav__link">
      EiO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/cache/writeboost/" title="Writeboost" class="md-nav__link">
      Writeboost
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Networking
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Networking
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="Concepts" class="md-nav__link md-nav__link--active">
      Concepts
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bondings/" title="Bondings" class="md-nav__link">
      Bondings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../10g/" title="TenGigabit" class="md-nav__link">
      TenGigabit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../40g/" title="FortyGigabit" class="md-nav__link">
      FortyGigabit
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Clusters & HA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Clusters & HA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../clusters/pacemaker/" title="Pacemaker" class="md-nav__link">
      Pacemaker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../clusters/stonith/" title="Stonith" class="md-nav__link">
      Stonith
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      OCF resources
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        OCF resources
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../clusters/ocf/eio/" title="EnhanceIO" class="md-nav__link">
      EnhanceIO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../clusters/ocf/writeboost/" title="Writeboost" class="md-nav__link">
      Writeboost
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../clusters/live-migration/" title="Live Migration" class="md-nav__link">
      Live Migration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Virtualization
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Virtualization
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../virtualization/concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../virtualization/disks/" title="Disk images" class="md-nav__link">
      Disk images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../virtualization/gpus/" title="GPUs" class="md-nav__link">
      GPUs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Setups
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Setups
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1">
    
    <label class="md-nav__link" for="nav-6-1">
      HA Clusters
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        HA Clusters
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../setups/ha/active_passive/" title="Active-Pasive" class="md-nav__link">
      Active-Pasive
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../setups/ha/active_active/" title="Active-Active" class="md-nav__link">
      Active-Active
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      Virtualization
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        Virtualization
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../setups/virtualization/gpu_sriov/" title="GPU SRIOV" class="md-nav__link">
      GPU SRIOV
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Utilities
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Utilities
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../utilities/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utilities/grafana/" title="Grafana" class="md-nav__link">
      Grafana
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../utilities/fio/" title="fio" class="md-nav__link">
      fio
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/license/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/isard-vdi/thedocs/edit/master/docs/networking/concepts.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="network-linux-commands">Network linux commands<a class="headerlink" href="#network-linux-commands" title="Permanent link">&para;</a></h1>
<h1 id="link-layer">Link layer<a class="headerlink" href="#link-layer" title="Permanent link">&para;</a></h1>
<p>Show interfaces:</p>
<div class="codehilite"><pre><span></span>ip link show
</pre></div>


<p>Enable/disable an interface:</p>
<div class="codehilite"><pre><span></span>ip link set eth0 down
ip link set eth0 up
</pre></div>


<p>Change name or address to interface manually:</p>
<div class="codehilite"><pre><span></span>ip link set eth0 down
ip link set eth0 address 00:11:22:33:44:55
ip link set eth0 name lan
ip link set eth0 up
</pre></div>


<p>Show interface options physical options</p>
<div class="codehilite"><pre><span></span>ethtool eth0
</pre></div>


<p>Show speed of interface:</p>
<div class="codehilite"><pre><span></span>ethtool eth0 |grep Speed
</pre></div>


<p>Kernel module that use the interface:</p>
<div class="codehilite"><pre><span></span>ethtool -i eth0
</pre></div>


<p>Show statistics, error packets, collisions:</p>
<div class="codehilite"><pre><span></span>ethtool -S eth0
</pre></div>


<h2 id="vlans">Vlans<a class="headerlink" href="#vlans" title="Permanent link">&para;</a></h2>
<p>Add virtual interface with tagged vlan 101 to eth0:</p>
<div class="codehilite"><pre><span></span>ip link add link eth0 name vlan101 type vlan id 101
ip link set vlan101 up
</pre></div>


<h2 id="bonding">Bonding<a class="headerlink" href="#bonding" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>ip link set eth1 down
ip link set eth2 down


modprobe -r bonding
modprobe bonding mode=4

# default xmit_hash_policy is 0 (hash with mac adress)
# modprobe bonding mode=4 xmit_hash_policy=2

ip link set eth1 master bond0
ip link set eth2 master bond0

ip link set eth1 up 
ip link set eth2 up

ip link set bond0 up

cat /proc/net/bonding/bond0
</pre></div>


<h2 id="test-network-speed-with-iperf">Test network speed with iperf<a class="headerlink" href="#test-network-speed-with-iperf" title="Permanent link">&para;</a></h2>
<p>Traditional tool is <strong>iperf</strong>, with speeds greater than 1Gbps new tool with more options <strong>iperf3</strong> is better</p>
<div class="codehilite"><pre><span></span>#Server
iperf -s 
#Client
iperf -c SERVER_IP
</pre></div>


<p>Some useful options:</p>
<div class="codehilite"><pre><span></span>#Server
iperf -s -i 2 -p 5002
#Client
iperf -p 5002 -c SERVER_IP
</pre></div>


<p>-t to increase duration of test</p>
<div class="codehilite"><pre><span></span>#Server
iperf -s -i 2
#Client
iperf -t 30 -c SERVER_IP
</pre></div>


<h2 id="test-network-speed-with-netperf">Test network speed with netperf<a class="headerlink" href="#test-network-speed-with-netperf" title="Permanent link">&para;</a></h2>
<p>Realistic test with tcp both directions throughput.</p>
<ul>
<li>https://github.com/HewlettPackard/netperf</li>
</ul>
<p>Start netserver on one host and execute script on client:</p>
<p>vi netperf-test.sh</p>
<div class="codehilite"><pre><span></span> for i in 1
     do
      netperf -H 10.1.2.102 -t TCP_STREAM -B &quot;outbound&quot; -i 10 -P 0 -v 0 \
        -- -s 256K -S 256K &amp;
      netperf -H 10.1.2.102 -t TCP_MAERTS -B &quot;inbound&quot;  -i 10 -P 0 -v 0 \
        -- -s 256K -S 256K &amp;
     done
</pre></div>


<p>It will run on background and output to console results when it finishes.</p>
<p>You can check live network throughput during test by using iftop:</p>
<div class="codehilite"><pre><span></span>iftop -i eth0
</pre></div>


<h2 id="bridges">Bridges<a class="headerlink" href="#bridges" title="Permanent link">&para;</a></h2>
<p>Create bridge:</p>
<div class="codehilite"><pre><span></span>brctl addif br0 usb0
</pre></div>


<p>Assign interfaces to bridge:</p>
<div class="codehilite"><pre><span></span>brctl addif br0 eth0
brctl addif br0 usb0
brctl addif br0 usb1
brctl delif br0 usb1
</pre></div>


<p>To show interfaces members of a bridge and table of ports and mac address:</p>
<div class="codehilite"><pre><span></span>brctl show
brctl show br0
brctl showmacs br0
</pre></div>


<h2 id="capture-packets">Capture packets<a class="headerlink" href="#capture-packets" title="Permanent link">&para;</a></h2>
<p><strong>tcpdump</strong>: herramienta clásica para hacer capturas</p>
<div class="codehilite"><pre><span></span>tcpdump -w 08232010.pcap -i eth0
</pre></div>


<p><strong>tshark</strong>: wireshark in command line, capture filters show [https://wiki.wireshark.org/CaptureFilters]</p>
<ul>
<li><strong>[ -i ]</strong> Input interface</li>
<li><strong>[ -w ]</strong> Output file</li>
<li><strong>[ -r ]</strong> Read options from file</li>
<li><strong>[ -c ]</strong>  limit packets captured</li>
<li><strong>[ -a duration:X]</strong> seconds when stop capture</li>
<li><strong>[ -Y ]</strong> Wireshark filters</li>
</ul>
<p>Examples:</p>
<div class="codehilite"><pre><span></span>tshark -i enp3s0 -w /tmp/out.pcap -c 10
tshark -i enp3s0 -w /tmp/out.pcap -a duration:4
tshark -r /tmp/out.pcap -w /tmp/web.pcap -Y &quot;http&quot;

tshark -i enp3s0 -w /tmp/ping.pcap &quot;host 8.8.8.8&quot;
tshark -i enp3s0 -w /tmp/web.pcap &quot;port 80&quot;
</pre></div>


<p>To show in screen the packets with extended version (-x)</p>
<div class="codehilite"><pre><span></span>tshark -r /tmp/web.pcap
tshark -r /tmp/web.pcap -x 
tshark -r /tmp/web.pcap -x -Y &quot;frame.number==10&quot;
</pre></div>


<h1 id="network-layer">Network Layer<a class="headerlink" href="#network-layer" title="Permanent link">&para;</a></h1>
<p>Show ip address, short command of <strong>ip address show</strong>:</p>
<div class="codehilite"><pre><span></span>ip a
</pre></div>


<p>Show stats (tx,rx,error,dropped)</p>
<div class="codehilite"><pre><span></span>ip -statistics a
</pre></div>


<h2 id="fixed-ip-address">Fixed ip address:<a class="headerlink" href="#fixed-ip-address" title="Permanent link">&para;</a></h2>
<p>Delete all address of an interface (flush):</p>
<div class="codehilite"><pre><span></span>ip a f dev eth0
</pre></div>


<p>Asociar una ip a una interfaz (no olvidar la máscara):</p>
<div class="codehilite"><pre><span></span>ip a a 192.168.100.10/24 dev eth0
</pre></div>


<p>Se pueden asociar más de una ip a una interfaz y eliminar una en concreto:</p>
<div class="codehilite"><pre><span></span>ip a a 192.168.100.10/24 dev eth0
ip a a 192.168.200.11/27 dev eth0

ip a d 192.168.200.11/27 dev eth0
</pre></div>


<h2 id="ips-dinamicas">Ips dinámicas:<a class="headerlink" href="#ips-dinamicas" title="Permanent link">&para;</a></h2>
<p>Liberar la ip actual:</p>
<div class="codehilite"><pre><span></span>dhclient -r
</pre></div>


<p>Esto debería haber liberado la ip actual y el daemon debería haber finalizado. En caso de que no podamos pedir una nueva ip no nos queda otra más que matar ese proceso con:</p>
<div class="codehilite"><pre><span></span>killall dhclient
</pre></div>


<p>Para pedir una nueva ip en cualquier interface:</p>
<div class="codehilite"><pre><span></span>dhclient
</pre></div>


<p>Y en una interface en concreto:</p>
<div class="codehilite"><pre><span></span>dhclient eth0
</pre></div>


<p>Si quieres ver más detalle de la concesión de ip:</p>
<div class="codehilite"><pre><span></span>dhclient -v eth0
dhclient -v -lf /tmp/eth0.lease
cat /tmp/eth0.lease
</pre></div>


<h2 id="tabla-arp">Tabla ARP<a class="headerlink" href="#tabla-arp" title="Permanent link">&para;</a></h2>
<p>La orden tradicional arp ha quedado centralizada en la utilidad ip con la opción <strong>ip neigh</strong> </p>
<p>Para ve la tabla de arp actual:</p>
<div class="codehilite"><pre><span></span>ip neigh
</pre></div>


<p>Borrar tabla de arp:</p>
<div class="codehilite"><pre><span></span>ip neigh flush all
</pre></div>


<p>Añadir entrada arp permanente:</p>
<div class="codehilite"><pre><span></span>ip neigh add 192.168.100.1 lladdr 00:11:22:33:44:55 dev enp3s0
</pre></div>


<p>Ver sólo las entradas reachable:</p>
<div class="codehilite"><pre><span></span>ip neigh show nud reachable
</pre></div>


<h2 id="routing">Routing<a class="headerlink" href="#routing" title="Permanent link">&para;</a></h2>
<p>Ver las rutas con <strong>ip route show</strong>:</p>
<div class="codehilite"><pre><span></span>ip r 
</pre></div>


<p>Para eliminar todas las rutas "ip route flush":</p>
<div class="codehilite"><pre><span></span>ip r f all
</pre></div>


<p>Al añadir una dirección ip a una interfaz, se añade una ruta directa
que informa que para ir a la red de esa dirección ip se va directamente
a través de la interfaz sin necesidad de pasar por ningún router:</p>
<div class="codehilite"><pre><span></span>$ ip r f all
$ ip a a 172.16.0.10/16 dev eth0
$ ip r s 
172.16.0.10/16  dev eth0 [...]
</pre></div>


<p>Añadir puerta de enlace por defecto:</p>
<div class="codehilite"><pre><span></span>ip r a default via 192.168.1.1
</pre></div>


<p>Eliminar puerta de enlace por defecto:</p>
<div class="codehilite"><pre><span></span>ip r d default
</pre></div>


<p>Añadir ruta estática:</p>
<div class="codehilite"><pre><span></span>ip r a 192.168.200.0/24 via 192.168.100.1
</pre></div>


<p>Activar bit de forwarding para que trabaje como router:</p>
<div class="codehilite"><pre><span></span>echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</pre></div>


<h2 id="resolucion-de-nombres-dns">Resolución de nombres DNS<a class="headerlink" href="#resolucion-de-nombres-dns" title="Permanent link">&para;</a></h2>
<p>Se consulta la resolución en el fichero <strong>/etc/hosts</strong>, que contiene
una línea para el nombre localhost, se pueden añadir líneas para
resolver nombres sin utilizar un servidor dns:</p>
<div class="codehilite"><pre><span></span>$ cat /etc/hosts
127.0.0.1       localhost.localdomain localhost
</pre></div>


<p>Para resolver con servidores dns linux consulta el contenido del fichero /etc/resolv.conf</p>
<div class="codehilite"><pre><span></span>$ cat /etc/resolv.conf 
[...]
nameserver 192.168.1.1
</pre></div>


<p>Se consulta la línea que empieza con nameserver seguida de la ip del servidor dns que queremos usar.
Si al renovar la ip dinámica el servidor dhcp ofrece un servidor dns se sobreescribe este fichero</p>
<p>Para forzar la resolución de nombres a través de un servidor dns de forma manual:</p>
<div class="codehilite"><pre><span></span>echo &quot;nameserver 8.8.8.8&quot; &gt; /etc/resolv.conf
</pre></div>


<h2 id="enmascaramiento-de-ips">Enmascaramiento de ips<a class="headerlink" href="#enmascaramiento-de-ips" title="Permanent link">&para;</a></h2>
<p>Enmascarar todo el tráfico que sale hacia internet por eth0</p>
<div class="codehilite"><pre><span></span>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
</pre></div>


<p>Consultar iptables:</p>
<div class="codehilite"><pre><span></span>iptables-save
iptables -t filter -L
iptables -t nat -L
</pre></div>


<h2 id="pruebas-de-conectividad">Pruebas de conectividad<a class="headerlink" href="#pruebas-de-conectividad" title="Permanent link">&para;</a></h2>
<p>Comprabar respuestas protocolo ARP:</p>
<div class="codehilite"><pre><span></span>arping 192.168.100.1
</pre></div>


<p>Hacer ping indefinidamente (para terminar ctrl + C)</p>
<div class="codehilite"><pre><span></span>ping 8.8.8.8
</pre></div>


<p>Limitar número de pings</p>
<div class="codehilite"><pre><span></span>ping -c 2 8.8.8.8
</pre></div>


<p><strong>fping</strong>: Hacer pings a varios equipos de una red:</p>
<div class="codehilite"><pre><span></span>fping -g 192.168.100.100 192.168.100.110 -a -q
fping -g 192.168.100.0/24 -a -q
</pre></div>


<p><strong>nmap</strong> </p>
<p>Sondeo ping:</p>
<div class="codehilite"><pre><span></span>nmap -sP 192.168.100.0/24
</pre></div>


<p>Sondeo de puerto 22</p>
<h2 id="traceroute-y-geolocalizar-ips">Traceroute y geolocalizar ips<a class="headerlink" href="#traceroute-y-geolocalizar-ips" title="Permanent link">&para;</a></h2>
<p><strong>traceroute</strong>: Herramienta histórica para descubrir rutas</p>
<div class="codehilite"><pre><span></span>traceroute 8.8.8.8
</pre></div>


<p><strong>mtr</strong>: Si quieres más información, estadísticas y detalle de geolocalización de ips</p>
<div class="codehilite"><pre><span></span>dnf -y install mtr GeoIP GeoIP-GeoLite-data GeoIP-GeoLite-data-extra
mtr -n --report www.gencat.cat
geoiplookup 72.52.92.222
</pre></div>


<h1 id="capa-de-transporte">Capa de transporte<a class="headerlink" href="#capa-de-transporte" title="Permanent link">&para;</a></h1>
<h2 id="nmap-y-sondeo-de-puertos">nmap y sondeo de puertos<a class="headerlink" href="#nmap-y-sondeo-de-puertos" title="Permanent link">&para;</a></h2>
<p>Sondeo de puertos TCP típicos:</p>
<div class="codehilite"><pre><span></span>nmap -sS 192.168.100.1
</pre></div>


<p>Sondeo de un puerto concreto</p>
<div class="codehilite"><pre><span></span>nmap -sS -p 80 192.168.100.1
</pre></div>


<p>Sondeo de rango de puertos</p>
<div class="codehilite"><pre><span></span>nmap -sS -p 8080-8090 192.168.100.1
</pre></div>


<p>Sondeo de puertos aunque el ping no conteste, añadiendo la opción -PN</p>
<div class="codehilite"><pre><span></span>nmap -sS -PN -p 80 192.168.100.1
</pre></div>


<p>Sondeo de puerto UDP:</p>
<div class="codehilite"><pre><span></span>nmap -sU -p 53 192.168.100.1
</pre></div>


<h2 id="netstat">netstat<a class="headerlink" href="#netstat" title="Permanent link">&para;</a></h2>
<p>número de puertos tcp y udp escuchando con el programa asociado:</p>
<div class="codehilite"><pre><span></span>netstat -utlnp
</pre></div>


<p>Las opciones se pueden combinar sin importar el orden en que van las letras,
las típicas de netstat son:
<em> -u =&gt; puertos udp
</em> -t =&gt; puertos tcp
<em> -p =&gt; programa que está usando esa conexión y pid (sólo lo puedes ver si eres root)
</em> -n =&gt; muestra el número de puerto
<em> -a =&gt; todas las conexiones
</em> -l =&gt; puertos en escucha</p>
<p>Todas las conexiones tcp:</p>
<div class="codehilite"><pre><span></span>netstat -tanp 
</pre></div>


<h2 id="probar-puertos-con-netcat">probar puertos con netcat<a class="headerlink" href="#probar-puertos-con-netcat" title="Permanent link">&para;</a></h2>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../storage/cache/writeboost/" title="Writeboost" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Writeboost
              </span>
            </div>
          </a>
        
        
          <a href="../tools/" title="Tools" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tools
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 <a href="http://www.isardvdi.com">IsardVDI</a>.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>